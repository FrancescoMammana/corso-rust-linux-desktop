<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progetto: Gestore Note Database | Corso Rust Linux Desktop</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="rust-logo">ü¶Ä</div>
            <h1>Corso Completo: Sviluppo Applicazioni Desktop Linux in Rust</h1>
        </div>
        <button class="menu-toggle" aria-label="Menu">‚ò∞</button>
    </header>

    <div class="container">
        <aside class="sidebar">
            <h3>üìö Corso</h3>
            <ul><li><a href="index.html">üè† Home</a></li></ul>
            <h3>1. Ambiente</h3>
            <ul><li><a href="lesson-1-1.html">1.1 Installazione Rust</a></li>
            <li><a href="lesson-1-2.html">1.2 Config VS Code</a></li>
            <li><a href="lesson-1-3.html">1.3 Strumenti Extra</a></li></ul>
            <h3>2. Rust Base</h3>
            <ul><li><a href="lesson-2-1.html">2.1 Sintassi</a></li>
            <li><a href="lesson-2-2.html">2.2 Controllo</a></li>
            <li><a href="lesson-2-3.html">2.3 Progetto</a></li>
            <li><a href="lesson-2-4.html">2.4 Crate</a></li></ul>
            <h3>3. GUI</h3>
            <ul><li><a href="lesson-3-1.html">3.1 GTK-rs</a></li>
            <li><a href="lesson-3-2.html">3.2 Glade</a></li>
            <li><a href="lesson-3-3.html">3.3 Manuale</a></li>
            <li><a href="lesson-3-4.html">3.4 Widget</a></li>
            <li><a href="lesson-3-5.html">3.5 Menu</a></li></ul>
            <h3>4. Progetti</h3>
            <ul><li><a href="lesson-4-1.html">4.1 Editor</a></li>
            <li><a href="lesson-4-2.html">4.2 Note DB</a></li>
            <li><a href="lesson-4-3.html">4.3 HTTP</a></li></ul>
            <h3>5. GitHub</h3>
            <ul><li><a href="lesson-5-1.html">5.1 Repository</a></li>
            <li><a href="lesson-5-2.html">5.2 Documentazione</a></li>
            <li><a href="lesson-5-3.html">5.3 Testing</a></li></ul>
            <h3>üìñ Risorse</h3>
            <ul><li><a href="about.html">‚ÑπÔ∏è Info Corso</a></li>
            <li><a href="resources.html">üîó Risorse</a></li>
            <li><a href="faq.html">‚ùì FAQ</a></li></ul>
        </aside>

        <main class="content">
            <nav class="breadcrumb"><a href="index.html">Home</a> > Sezione 4: Progetti Pratici > Progetto: Gestore Note Database</nav>
            <h2 class="lesson-title">Progetto: Gestore Note Database</h2>

            <div class="box box-theory">
                <h3>üìò Introduzione Teorica</h3>
                <p><strong>Gestore note con SQLite</strong> che dimostra CRUD operations complete:</p>
<ul>
    <li><strong>SQLite</strong>: Database embedded leggero e portatile</li>
    <li><strong>rusqlite</strong>: Crate Rust per accedere SQLite</li>
    <li><strong>CRUD</strong>: Create, Read, Update, Delete operazioni</li>
    <li><strong>ListBox</strong>: Lista note selezionabile</li>
    <li><strong>State sync</strong>: Sincronizzazione DB ‚Üî UI bidiretta</li>
    <li><strong>Search</strong>: Ricerca e filtro note</li>
    <li><strong>Persistenza</strong>: Dati salvati tra sessioni</li>
</ul>
<p>Applicazione dimostra pattern professionali per gestire persistenza dati in Rust.</p>
            </div>

            <div class="box box-steps">
                <h3>üîß Procedura Passo-Passo</h3>
                <ol>
    <li><strong>Aggiungi rusqlite a Cargo.toml</strong>
        <pre><code>[dependencies]
gtk = "0.18"
rusqlite = { version = "0.29", features = ["bundled"] }</code></pre>
    </li>

    <li><strong>Schema database</strong>
        <pre><code>CREATE TABLE IF NOT EXISTS notes (
    id INTEGER PRIMARY KEY,
    title TEXT NOT NULL,
    content TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);</code></pre>
    </li>

    <li><strong>CRUD functions</strong>
        <pre><code>fn add_note(conn: &Connection, title: &str, content: &str) -> Result<()> {
    conn.execute(
        "INSERT INTO notes (title, content) VALUES (?1, ?2)",
        [title, content]
    )?;
    Ok(())
}

fn get_all_notes(conn: &Connection) -> Result<Vec<Note>> {
    let mut stmt = conn.prepare("SELECT id, title, content FROM notes")?;
    // Mappa risultati
}</code></pre>
    </li>

    <li><strong>Integrazione GTK</strong>
        <pre><code>let listbox = ListBox::new();
for note in notes {
    let row = ListBoxRow::new();
    let label = Label::new(Some(&note.title));
    row.add(&label);
    listbox.add(&row);
}</code></pre>
    </li>
</ol>
            </div>

            <div class="box box-code">
                <h3>üíª Codice Sorgente Commentato</h3>
                <pre><code>// ========================================
// PROGETTO: GESTORE NOTE CON DATABASE
// ========================================

use rusqlite::{Connection, Result};
use gtk::prelude::*;
use gtk::{ListBox, Button, Entry};

#[derive(Debug, Clone)]
struct Note {
    id: i32,
    title: String,
    content: String,
}

fn init_db() -> Result<Connection> {
    let conn = Connection::open("notes.db")?;
    conn.execute(
        "CREATE TABLE IF NOT EXISTS notes (
            id INTEGER PRIMARY KEY,
            title TEXT NOT NULL,
            content TEXT,
            created_at DATETIME DEFAULT CURRENT_TIMESTAMP
        )", []
    )?;
    Ok(conn)
}

fn add_note(conn: &Connection, title: &str, content: &str) -> Result<()> {
    conn.execute(
        "INSERT INTO notes (title, content) VALUES (?1, ?2)",
        [title, content]
    )?;
    Ok(())
}

fn get_all_notes(conn: &Connection) -> Result<Vec<Note>> {
    let mut stmt = conn.prepare("SELECT id, title, content FROM notes")?;
    let notes = stmt.query_map([], |row| {
        Ok(Note {
            id: row.get(0)?,
            title: row.get(1)?,
            content: row.get(2)?,
        })
    })?;

    let mut result = Vec::new();
    for note in notes {
        result.push(note?);
    }
    Ok(result)
}

fn update_note(conn: &Connection, id: i32, title: &str, content: &str) -> Result<()> {
    conn.execute(
        "UPDATE notes SET title = ?1, content = ?2 WHERE id = ?3",
        [title, content, &id.to_string()]
    )?;
    Ok(())
}

fn delete_note(conn: &Connection, id: i32) -> Result<()> {
    conn.execute("DELETE FROM notes WHERE id = ?1", [id])?;
    Ok(())
}

fn search_notes(conn: &Connection, query: &str) -> Result<Vec<Note>> {
    let mut stmt = conn.prepare(
        "SELECT id, title, content FROM notes WHERE title LIKE ?1 OR content LIKE ?1"
    )?;
    let pattern = format!("%{}%", query);
    let notes = stmt.query_map([pattern], |row| {
        Ok(Note {
            id: row.get(0)?,
            title: row.get(1)?,
            content: row.get(2)?,
        })
    })?;

    let mut result = Vec::new();
    for note in notes {
        result.push(note?);
    }
    Ok(result)
}
</code></pre>
            </div>

            <div class="box box-exercises">
                <h3>‚úèÔ∏è Esercizi Pratici</h3>
                <ol>
    <li><strong>CRUD Completo</strong>
        <p>Implementa Create (form), Read (lista), Update (edit), Delete (confirm) funzionanti.</p>
    </li>

    <li><strong>UI con ListBox</strong>
        <p>Mostra note in ListBox cliccabile, click ‚Üí carica contenuto in TextView.</p>
    </li>

    <li><strong>Ricerca Dinamica</strong>
        <p>Entry per cercare, filtra lista in tempo reale con connect_changed.</p>
    </li>

    <li><strong>Export JSON</strong>
        <p>Salva tutte le note in file JSON con serde_json per backup/migrazione.</p>
    </li>

    <li><strong>Ordinamento</strong>
        <p>Bottoni "Nome A‚ÜíZ", "Data ‚Üì", "Modifica ‚Üì" per ordinare lista.</p>
    </li>

    <li><strong>Challenge: Import CSV</strong>
        <p>Importa note da file CSV, parsifica con csv crate e popola database.</p>
    </li>
</ol>
            </div>

            <div class="box box-troubleshooting">
                <h3>‚ö†Ô∏è Troubleshooting</h3>
                <h4>‚ùå Database locked</h4>
<p><strong>Causa:</strong> Connection non rilasciata o accesso contemporaneo.</p>
<p><strong>Soluzione:</strong> Usa Rc&lt;RefCell&lt;Connection&gt;&gt; per condividere in sicurezza.</p>

<h4>‚ùå "no such table: notes"</h4>
<p><strong>Causa:</strong> Database creato in directory diversa.</p>
<p><strong>Soluzione:</strong> Controlla current_dir() e usa path assoluto.</p>

<h4>‚ùå Note non appare in ListBox</h4>
<p><strong>Soluzione:</strong> Chiama listbox.show_all() dopo aggiungere righe.</p>

<h4>üí° Tip: Transactions</h4>
<p>Usa conn.transaction() per batch operations atomiche.</p>
            </div>

            <nav class="lesson-nav">
                <a href="lesson-4-1.html">‚Üê Precedente</a>
                <a href="lesson-4-3.html">Successiva ‚Üí</a>
            </nav>
        </main>
    </div>

    <footer>
        <p>&copy; 2025 Corso Rust Linux Desktop | Creato con ‚ù§Ô∏è per la community Rust</p>
        <p><a href="https://www.rust-lang.org" target="_blank">Rust Programming Language</a> | <a href="https://gtk-rs.org" target="_blank">GTK-rs</a></p>
    </footer>

    <script src="script.js"></script>
</body>
</html>